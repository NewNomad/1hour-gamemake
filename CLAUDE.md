# CLAUDE.md

このファイルは、このリポジトリでコードを扱う際のClaude Code（claude.ai/code）へのガイダンスを提供します。

## プロジェクト概要

p5.jsで構築されたシンプルなアクションゲームを通じて「ゲーム開発の楽しさ」を教える1時間のゲーム開発ワークショッププロジェクトです。ハンズオン実装を通じて、3つの基本的なゲーム設計原則を実演します。

## アーキテクチャ

### 2層構造
- **game-base/**: 基本的なメカニクスを持つ土台版（最小限の実行可能ゲーム）
- **game-complete/**: 3つのゲーム設計法則をすべて実装した完全版

### 主要な設計パターン
- **オブジェクト指向クラス**: Player、Enemy、GameStateが継承するGameObject基底クラス
- **設定駆動設計**: 簡単な実験のためにCONFIGオブジェクトにすべてのパラメーターを集約
- **モジュラーシステム**: 3つの法則システム（選択、フィードバック、発見）を独立したモジュールとして実装
- **段階的複雑化**: 各実装フェーズが段階的に構築される

## ゲーム設計の3つの法則

### 法則1: 意味のある選択
- 敵との距離に基づくリスク・リワードシステム
- 近距離: 高ダメージ、高リスク
- 遠距離: 低ダメージ、ペナルティ（敵の出現速度増加）
- 実装: 距離ベースのダメージ倍率と出現率調整

### 法則2: フィードバックループ
- プレイヤーのアクションに対する即座の視覚・音響反応
- 画面揺れ、パーティクルエフェクト、コンボカウンター
- 実装: 視覚フィードバッククラスによるエフェクトシステム

### 法則3: 発見の喜び
- 隠しコンボとエマージェントゲームプレイメカニクス
- 敵同士の相互作用、秘密パターン、ランダム要素
- 実装: 特別な組み合わせを検出する発見システム

## CONFIG システム

CONFIGオブジェクトは実験体験の中核です：

```javascript
CONFIG.PLAYER_SPEED = 5;           // 基本移動
CONFIG.LAW_OF_CHOICE.RISK_MULTIPLIER = 3;  // リスク・リワードバランス
CONFIG.LAW_OF_FEEDBACK.SCREEN_SHAKE = 5;   // 視覚フィードバック
CONFIG.LAW_OF_DISCOVERY.CRITICAL_CHANCE = 0.1;  // 隠しメカニクス
```

リアルタイム調整関数:
- `adjustConfig(key, value)` - 任意の設定値を変更
- `quickTest()` - 高速テストモードを有効化
- `chaosMode()` - 極端なパラメーターテスト
- `godMode()` - 実験用の無敵モード

## 開発コマンド

従来のビルドシステムなし - CDNを使用した静的ファイル：
- **実行**: ブラウザで`index.html`を開く（任意のWebサーバー）
- **デバッグ**: ゲーム中に'D'キーでデバッグモード切り替え
- **リスタート**: ゲームオーバー後に'R'キー
- **コンソールテスト**: ブラウザ開発者ツールでリアルタイムCONFIG変更

## ファイル構造

### game-base/ (土台版)
```
js/
├── config.js          # すべてのゲームパラメーター
├── main.js            # p5.js setup/drawループ
├── classes/
│   ├── GameObject.js   # すべてのゲームオブジェクトの基底クラス
│   ├── Player.js      # プレイヤーの移動と状態
│   ├── Enemy.js       # 基本的な敵の動作
│   └── GameState.js   # ゲーム状態とオブジェクト管理
└── utils/
    ├── collision.js   # 当たり判定ユーティリティ
    └── helpers.js     # 共通ヘルパー関数
```

### game-complete/ (完全版)
```
js/
├── systems/           # 3つの法則の実装
│   ├── choice.js      # リスク・リワード計算
│   ├── feedback.js    # 視覚・音響フィードバック
│   └── discovery.js   # 隠しメカニクス検出
├── classes/
│   ├── Effect.js      # パーティクルと視覚エフェクト
│   └── UIManager.js   # UI描画と管理
└── utils/
    └── particles.js   # 高度なパーティクルシステム
```

## 主要クラス

### GameObject (基底クラス)
- 位置、サイズ、ライフサイクル管理
- 共通メソッド: `update()`, `render()`, `getBounds()`, `isOffScreen()`
- すべてのゲームオブジェクトがこれを継承

### Player
- WASDと矢印キーの入力処理
- 画面境界制約
- 視覚フィードバック付き無敵システム
- リスク・リワード用の敵との距離計算

### Enemy
- 複数の移動パターン（直進、波、ホーミング）
- タイプベースのプロパティ（色、速度、HP）
- 当たり判定と破壊処理

### GameState
- 中央ゲームループの調整
- オブジェクトライフサイクル管理（出現、削除）
- 状態遷移（メニュー、プレイ中、ゲームオーバー）
- 統計追跡

## ワークショップの哲学

このコードベースは実験と学習のために設計されています：

1. **即座のフィードバック**: 変更が即座に結果として表示される
2. **フェイルセーフ設計**: 壊れたパラメーターでもゲームがクラッシュしない
3. **段階的複雑化**: シンプルに始めて、段階的に洗練度を追加
4. **パラメーター駆動**: ほぼすべてがCONFIGで制御される
5. **発見志向**: 隠しメカニクスが探索を報酬として与える

## 実装メモ

- 明確な継承階層を持つES6クラスを使用
- p5.js CDN以外の外部依存関係なし
- 調整用にすべてのマジックナンバーをCONFIGに外部化
- デバッグモードで当たり判定と内部状態を表示
- ワークショップ中のライブ実験に対応したコンソールフレンドリー設計
- 60分間のハンズオン学習セッション用に設計

## ゲームの拡張

一般的な拡張ポイント：
- CONFIG.ENEMY_TYPESを介した新しい敵タイプの追加
- Enemy.updateMovement()での新しい移動パターンの作成
- Effectクラスでの新しいエフェクトタイプの実装
- GameStateでのプラグインシステムフックの追加
- 実験パラメーターでのCONFIGの拡張

このアーキテクチャは高速プロトタイピングをサポートし、パラメーター操作による「もしも」探索を奨励します。